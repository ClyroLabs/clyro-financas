<div class="relative w-full min-h-full overflow-hidden bg-[#020617] rounded-3xl border border-white/5 shadow-2xl">
  <!-- Electric/Fintech Background (Login Style) -->
  <div class="absolute inset-0 w-full h-full overflow-hidden pointer-events-none">
    <div
      class="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[conic-gradient(from_0deg,transparent_0_340deg,#06b6d4_360deg)] animate-spin-slow mix-blend-color-dodge filter blur-[25px] opacity-60">
    </div>
    <div
      class="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[conic-gradient(from_180deg,transparent_0_340deg,#3b82f6_360deg)] animate-reverse-spin mix-blend-color-dodge filter blur-[25px] opacity-60">
    </div>
  </div>

  <div class="relative z-10 p-6 lg:p-8">
    <div class="container mx-auto max-w-4xl">
      <h2 class="text-3xl font-bold text-white mb-8 drop-shadow-md">{{ 'admin_dashboard' | translate }}</h2>

      <div class="space-y-10">

        <!-- General Settings -->
        @if (generalForm) {
        <form [formGroup]="generalForm" (ngSubmit)="saveGeneralSettings()" class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'general_settings' |
            translate }}</h3>
          <div class="space-y-5">
            <div>
              <label for="appName" class="block text-sm font-bold text-white mb-1.5">{{ 'app_name' | translate
                }}</label>
              <input type="text" id="appName" formControlName="appName" class="clyro-input">
            </div>
            <div>
              <label for="appLogoUrl" class="block text-sm font-bold text-white mb-1.5">{{ 'app_logo_url' | translate
                }}</label>
              <input type="text" id="appLogoUrl" formControlName="appLogoUrl" class="clyro-input">
              <p class="text-xs text-gray-500 mt-1">{{ 'app_logo_url_desc' | translate }}</p>
            </div>
            <div>
              <label for="siteUrl" class="block text-sm font-bold text-white mb-1.5">{{ 'official_site_url' | translate
                }}</label>
              <input type="text" id="siteUrl" formControlName="siteUrl" class="clyro-input">
            </div>
          </div>
          <div class="flex justify-end mt-8">
            <button type="submit" [disabled]="generalForm.invalid"
              class="px-6 py-2.5 text-white font-bold rounded-xl btn-primary-gradient disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
              {{ 'save_configuration' | translate }}
            </button>
          </div>
        </form>
        }

        <!-- User Management -->
        <div class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'user_management' |
            translate }}</h3>
          <div class="overflow-x-auto custom-scrollbar">
            <table class="min-w-full divide-y divide-white/10">
              <thead class="bg-black/20">
                <tr>
                  <th scope="col"
                    class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{
                    'user_name' | translate }}</th>
                  <th scope="col"
                    class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{
                    'user_email' | translate }}</th>
                  <th scope="col"
                    class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{
                    'user_plan' | translate }}</th>
                  <th scope="col"
                    class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ 'status' |
                    translate }}</th>
                  <th scope="col"
                    class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{
                    'user_role' | translate }}</th>
                  <th scope="col" class="relative px-4 py-3"><span class="sr-only">{{ 'actions' | translate }}</span>
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-white/10 bg-transparent">
                @for (user of users(); track user.id) {
                <tr class="hover:bg-white/5 transition-colors">
                  <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-white">{{ user.name }}</td>
                  <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-300">{{ user.email }}</td>
                  <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-400 capitalize">{{ user.subscriptionPlan }}
                  </td>
                  <td class="px-4 py-4 whitespace-nowrap text-sm">
                    @if (user.status === 'blocked') {
                    <span
                      class="px-2 py-1 text-xs font-medium rounded-full bg-red-500/20 text-red-400 border border-red-500/30">{{
                      'blocked' | translate }}</span>
                    } @else {
                    <span
                      class="px-2 py-1 text-xs font-medium rounded-full bg-green-500/20 text-green-400 border border-green-500/30">{{
                      'active' | translate }}</span>
                    }
                  </td>
                  <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-400 capitalize">{{ user.role }}</td>
                  <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                    @if (user.status === 'blocked') {
                    <button (click)="unblockUser(user)"
                      class="text-green-400 hover:text-green-300 transition-colors bg-green-500/10 px-3 py-1 rounded-lg hover:bg-green-500/20">{{
                      'unblock' | translate }}</button>
                    } @else {
                    <button (click)="openBlockUserModal(user)"
                      class="text-yellow-400 hover:text-yellow-300 transition-colors bg-yellow-500/10 px-3 py-1 rounded-lg hover:bg-yellow-500/20">{{
                      'block' | translate }}</button>
                    }
                    <button (click)="openDeleteUserModal(user)"
                      class="text-red-400 hover:text-red-300 transition-colors bg-red-500/10 px-3 py-1 rounded-lg hover:bg-red-500/20">{{
                      'delete' | translate }}</button>
                  </td>
                </tr>
                } @empty {
                <tr>
                  <td colspan="6" class="px-6 py-8 text-center text-sm text-gray-500">{{ 'no_users_found' | translate }}
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>

        <!-- Price Management -->
        @if (priceForm) {
        <form [formGroup]="priceForm" (ngSubmit)="updatePrices()" class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'price_management' |
            translate }}</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Basic Plan Prices -->
            <div class="space-y-5">
              <h4 class="text-lg font-bold text-white mb-2">{{ 'basic' | translate }}</h4>
              <div>
                <label for="basicMonthly" class="block text-sm font-bold text-white mb-1.5">{{ 'monthly' | translate }}
                  ($)</label>
                <input type="number" id="basicMonthly" formControlName="basicMonthly" class="clyro-input">
              </div>
              <div>
                <label for="basicYearly" class="block text-sm font-bold text-white mb-1.5">{{ 'yearly' | translate }}
                  ($)</label>
                <input type="number" id="basicYearly" formControlName="basicYearly" class="clyro-input">
                @if (priceForm.hasError('basicYearlyInvalid')) {
                <p class="text-red-400 text-xs mt-1">{{ 'admin_error_yearly_vs_monthly' | translate }}</p>
                }
              </div>
            </div>
            <!-- Premium Plan Prices -->
            <div class="space-y-5">
              <h4 class="text-lg font-bold text-white mb-2">{{ 'premium' | translate }}</h4>
              <div>
                <label for="premiumMonthly" class="block text-sm font-bold text-white mb-1.5">{{ 'monthly' | translate
                  }} ($)</label>
                <input type="number" id="premiumMonthly" formControlName="premiumMonthly" class="clyro-input">
              </div>
              <div>
                <label for="premiumYearly" class="block text-sm font-bold text-white mb-1.5">{{ 'yearly' | translate }}
                  ($)</label>
                <input type="number" id="premiumYearly" formControlName="premiumYearly" class="clyro-input">
                @if (priceForm.hasError('premiumYearlyInvalid')) {
                <p class="text-red-400 text-xs mt-1">{{ 'admin_error_yearly_vs_monthly' | translate }}</p>
                }
              </div>
            </div>
          </div>
          <div class="flex justify-end mt-8">
            <button type="submit" [disabled]="priceForm.invalid"
              class="px-6 py-2.5 text-white font-bold rounded-xl btn-primary-gradient disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
              {{ 'update_prices' | translate }}
            </button>
          </div>
        </form>
        }

        <!-- Payment Gateways -->
        @if (paymentForm) {
        <form [formGroup]="paymentForm" (ngSubmit)="savePaymentConfiguration()" class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'payment_gateways' |
            translate }}</h3>
          <div class="space-y-5">
            <div>
              <label for="stripeApiKey" class="block text-sm font-bold text-white mb-1.5">{{ 'stripe_api_key' |
                translate }}</label>
              <input type="text" id="stripeApiKey" formControlName="stripeApiKey" class="clyro-input">
            </div>
            <div>
              <label for="gatePayClientId" class="block text-sm font-bold text-white mb-1.5">{{ 'gatepay_client_id' |
                translate }}</label>
              <input type="text" id="gatePayClientId" formControlName="gatePayClientId" class="clyro-input">
            </div>
            <div>
              <label for="gatePayApiKey" class="block text-sm font-bold text-white mb-1.5">{{ 'gatepay_api_key' |
                translate }}</label>
              <input type="text" id="gatePayApiKey" formControlName="gatePayApiKey" class="clyro-input">
            </div>
            <div>
              <label for="gatePayApiSecret" class="block text-sm font-bold text-white mb-1.5">{{ 'gatepay_api_secret' |
                translate }}</label>
              <input type="text" id="gatePayApiSecret" formControlName="gatePayApiSecret" class="clyro-input">
            </div>
          </div>
          <div class="flex justify-end mt-8">
            <button type="submit" [disabled]="paymentForm.invalid"
              class="px-6 py-2.5 text-white font-bold rounded-xl btn-primary-gradient disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
              {{ 'save_configuration' | translate }}
            </button>
          </div>
        </form>
        }

        <!-- Checkout Customization -->
        @if (checkoutForm) {
        <form [formGroup]="checkoutForm" (ngSubmit)="saveCheckoutSettings()" class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'checkout_customization'
            | translate }}</h3>
          <div class="space-y-5">
            <div>
              <label for="checkoutLogoUrl" class="block text-sm font-bold text-white mb-1.5">{{ 'checkout_logo_url' |
                translate }}</label>
              <input type="text" id="checkoutLogoUrl" formControlName="checkoutLogoUrl" class="clyro-input">
            </div>
            <div class="flex items-center">
              <div class="flex items-center h-5">
                <input id="enableCreditCard" type="checkbox" formControlName="enableCreditCard"
                  class="w-5 h-5 rounded border-gray-600 bg-white/5 text-cyan-600 focus:ring-cyan-500 focus:ring-offset-gray-900 transition-all cursor-pointer">
              </div>
              <div class="ml-3 text-sm">
                <label for="enableCreditCard" class="font-bold text-white cursor-pointer">{{
                  'enable_credit_card_payments' | translate }}</label>
              </div>
            </div>
            <div class="flex items-center">
              <div class="flex items-center h-5">
                <input id="enableCrypto" type="checkbox" formControlName="enableCrypto"
                  class="w-5 h-5 rounded border-gray-600 bg-white/5 text-cyan-600 focus:ring-cyan-500 focus:ring-offset-gray-900 transition-all cursor-pointer">
              </div>
              <div class="ml-3 text-sm">
                <label for="enableCrypto" class="font-bold text-white cursor-pointer">{{ 'enable_crypto_payments' |
                  translate }}</label>
              </div>
            </div>
          </div>
          <div class="flex justify-end mt-8">
            <button type="submit" [disabled]="checkoutForm.invalid"
              class="px-6 py-2.5 text-white font-bold rounded-xl btn-primary-gradient disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
              {{ 'save_configuration' | translate }}
            </button>
          </div>
        </form>
        }

        <!-- Notification Management -->
        <div class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{
            'notification_management' | translate }}</h3>
          <div class="flex items-center justify-between">
            <div>
              <p class="font-bold text-white">{{ 'notification_status_label' | translate }}</p>
              @switch (notificationService.permission()) {
              @case ('granted') { <p class="text-sm text-green-400 mt-1">{{ 'notification_status_granted' | translate }}
              </p> }
              @case ('denied') { <p class="text-sm text-red-400 mt-1">{{ 'notification_status_denied' | translate }}</p>
              }
              @default { <p class="text-sm text-yellow-400 mt-1">{{ 'notification_status_default' | translate }}</p> }
              }
            </div>
            @if(notificationService.permission() === 'granted') {
            <button (click)="sendTestNotification()"
              class="px-4 py-2 text-sm font-semibold text-white bg-white/10 border border-white/10 rounded-xl hover:bg-white/20 transition-all shadow-sm">
              {{ 'send_test_notification' | translate }}
            </button>
            } @else {
            <button (click)="notificationService.requestPermission()"
              class="px-4 py-2 text-sm font-semibold text-white bg-white/10 border border-white/10 rounded-xl hover:bg-white/20 transition-all shadow-sm">
              Enable Notifications
            </button>
            }
          </div>
        </div>

        <!-- Theme Settings -->
        <div class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'theme_settings' |
            translate }}</h3>
          <div class="flex flex-wrap gap-4">
            <button (click)="setTheme('dark')"
              [class]="currentTheme() === 'dark' ? 'btn-neon-cyan' : 'px-6 py-3 text-white font-semibold rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
              {{ 'theme_dark' | translate }}
            </button>
            <button (click)="setTheme('light')"
              [class]="currentTheme() === 'light' ? 'btn-neon-cyan' : 'px-6 py-3 text-white font-semibold rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              {{ 'theme_light' | translate }}
            </button>
            <button (click)="setTheme('transparent')"
              [class]="currentTheme() === 'transparent' ? 'btn-neon-cyan' : 'px-6 py-3 text-white font-semibold rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              {{ 'theme_transparent' | translate }}
            </button>
          </div>
        </div>

        <!-- Financial Reports (Clyro Labs Internal) -->
        <div class="glass-content p-8">
          <h3 class="text-xl font-semibold text-cyan-400 border-b border-white/10 pb-4 mb-6">{{ 'financial_reports' |
            translate }}</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Active Subscriptions -->
            <div class="neon-card p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-400">{{ 'active_subscriptions' | translate }}</p>
                  <p class="text-3xl font-bold text-white mt-1">{{ financialReport().totalActiveSubscriptions }}</p>
                </div>
                <div class="p-3 bg-cyan-500/20 rounded-xl">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-cyan-400" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
              </div>
            </div>
            <!-- Monthly Revenue -->
            <div class="neon-card p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-400">{{ 'monthly_revenue' | translate }}</p>
                  <p class="text-3xl font-bold text-green-400 mt-1">${{ financialReport().monthlyRevenue |
                    number:'1.2-2' }}</p>
                </div>
                <div class="p-3 bg-green-500/20 rounded-xl">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-400" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
            </div>
            <!-- Blocked Users -->
            <div class="neon-card p-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-400">{{ 'blocked_users' | translate }}</p>
                  <p class="text-3xl font-bold text-red-400 mt-1">{{ financialReport().blockedUsers }}</p>
                </div>
                <div class="p-3 bg-red-500/20 rounded-xl">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-400" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                  </svg>
                </div>
              </div>
            </div>
          </div>
          <!-- User Distribution -->
          <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/10">
              <span class="text-gray-400">{{ 'free_users' | translate }}</span>
              <span class="text-xl font-bold text-white">{{ financialReport().freeUsers }}</span>
            </div>
            <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/10">
              <span class="text-gray-400">{{ 'basic_users' | translate }}</span>
              <span class="text-xl font-bold text-blue-400">{{ financialReport().basicUsers }}</span>
            </div>
            <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/10">
              <span class="text-gray-400">{{ 'premium_users' | translate }}</span>
              <span class="text-xl font-bold text-purple-400">{{ financialReport().premiumUsers }}</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<app-confirmation-modal [show]="showDeleteUserModal()" [isProcessing]="isDeletingUser()"
  titleKey="delete_user_confirm_title" messageKey="delete_user_confirm_body" [messageParams]="deleteUserMessageParams()"
  confirmButtonKey="delete_user" (confirm)="confirmDeleteUser()" (cancel)="cancelDeleteUser()">
</app-confirmation-modal>

<!-- Block User Modal -->
@if (showBlockUserModal()) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="glass-content p-8 max-w-md w-full mx-4 animate-fade-in">
    <h3 class="text-xl font-bold text-white mb-4">{{ 'block_user_title' | translate }}</h3>
    <p class="text-gray-400 mb-6">{{ 'block_user_message' | translate:{ email: userToBlock()?.email } }}</p>

    <div class="space-y-4 mb-6">
      <label class="block text-sm font-bold text-white mb-2">{{ 'block_reason' | translate }}</label>
      <select [value]="blockReason()" (change)="blockReason.set($any($event.target).value)"
        class="clyro-select clyro-input w-full">
        <option value="">{{ 'select_reason' | translate }}</option>
        @for (reason of blockReasonOptions; track reason) {
        <option [value]="reason">{{ reason | translate }}</option>
        }
      </select>
    </div>

    <div class="flex gap-4">
      <button (click)="cancelBlockUser()"
        class="flex-1 px-4 py-3 text-white font-semibold rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-all">
        {{ 'cancel' | translate }}
      </button>
      <button (click)="confirmBlockUser()" [disabled]="!blockReason() || isBlockingUser()"
        class="flex-1 px-4 py-3 text-white font-semibold rounded-xl bg-red-500 hover:bg-red-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        @if (isBlockingUser()) {
        <svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
        } @else {
        {{ 'block_user' | translate }}
        }
      </button>
    </div>
  </div>
</div>
}