<div class="relative w-full min-h-full overflow-hidden bg-[#020617] rounded-3xl border border-white/5 shadow-2xl">
    <!-- Electric/Fintech Background (Login Style) -->
    <div class="absolute inset-0 w-full h-full overflow-hidden pointer-events-none">
        <!-- Beam 1: Cyan Electric -->
        <div
            class="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[conic-gradient(from_0deg,transparent_0_340deg,#06b6d4_360deg)] animate-spin-slow mix-blend-color-dodge filter blur-[25px] opacity-60">
        </div>
        <!-- Beam 2: Deep Blue Electric -->
        <div
            class="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[conic-gradient(from_180deg,transparent_0_340deg,#3b82f6_360deg)] animate-reverse-spin mix-blend-color-dodge filter blur-[25px] opacity-60">
        </div>
    </div>

    <!-- Content -->
    <div class="relative z-10 p-4 sm:p-6 lg:p-8 h-full flex flex-col">
        <div class="max-w-4xl mx-auto w-full">
            <h1 class="text-2xl font-bold tracking-tight text-white drop-shadow-md">{{ 'financial_snapshot' | translate
                }}</h1>
            <p class="mt-2 text-sm text-gray-300">
                {{ 'financial_snapshot_desc' | translate }}
            </p>
        </div>

        <div class="mt-8 flex-grow flex flex-col lg:flex-row gap-8 max-w-7xl mx-auto w-full">
            <!-- Input Form -->
            <div class="lg:w-1/2 flex flex-col">
                <form [formGroup]="financialForm" (ngSubmit)="saveData()" class="glass-content flex flex-col h-full">
                    <!-- Scrollable Content Area -->
                    <div class="overflow-auto custom-scrollbar flex-1 p-4 sm:p-6 space-y-6"
                        style="max-height: calc(100vh - 20rem);">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <!-- Revenue -->
                            <div class="space-y-4">
                                <h3
                                    class="text-sm font-semibold text-green-400 uppercase tracking-wider border-b border-green-500/20 pb-1">
                                    {{ 'revenue' | translate }}</h3>
                                <div>
                                    <label for="fixedRevenue" class="block text-xs font-bold text-white mb-1">{{
                                        'fixed_revenue' | translate }}</label>
                                    <input type="text" appCurrencyMask id="fixedRevenue" formControlName="fixedRevenue"
                                        class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'fixed_revenue_desc' | translate }}</p>
                                </div>
                                <div>
                                    <label for="sporadicRevenue" class="block text-xs font-bold text-white mb-1">{{
                                        'sporadic_revenue' | translate }}</label>
                                    <input type="text" appCurrencyMask id="sporadicRevenue"
                                        formControlName="sporadicRevenue" class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'sporadic_revenue_desc' | translate }}
                                    </p>
                                </div>
                            </div>
                            <!-- Expenses -->
                            <div class="space-y-4">
                                <h3
                                    class="text-sm font-semibold text-red-400 uppercase tracking-wider border-b border-red-500/20 pb-1">
                                    {{ 'expenses' | translate }}</h3>
                                <div>
                                    <label for="fixedExpenses" class="block text-xs font-bold text-white mb-1">{{
                                        'fixed_expenses' | translate }}</label>
                                    <input type="text" appCurrencyMask id="fixedExpenses"
                                        formControlName="fixedExpenses" class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'fixed_expenses_desc' | translate }}
                                    </p>
                                </div>
                                <div>
                                    <label for="unforeseenExpenses" class="block text-xs font-bold text-white mb-1">{{
                                        'unforeseen_expenses' | translate }}</label>
                                    <input type="text" appCurrencyMask id="unforeseenExpenses"
                                        formControlName="unforeseenExpenses" class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'unforeseen_expenses_desc' | translate
                                        }}</p>
                                </div>
                                <div>
                                    <label for="personalSpending" class="block text-xs font-bold text-white mb-1">{{
                                        'personal_spending' | translate }}</label>
                                    <input type="text" appCurrencyMask id="personalSpending"
                                        formControlName="personalSpending" class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'personal_spending_desc' | translate }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- Product/Service Pricing -->
                        <div class="pt-6 neon-divider">
                            <h3
                                class="text-sm font-semibold text-cyan-400 uppercase tracking-wider border-b border-cyan-500/20 pb-1">
                                {{ 'product_service_pricing' | translate }}</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4">
                                <div>
                                    <label for="productCost" class="block text-xs font-bold text-white mb-1">{{
                                        'product_cost' | translate }}</label>
                                    <input type="text" appCurrencyMask id="productCost" formControlName="productCost"
                                        class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'product_cost_desc' | translate }}</p>
                                </div>
                                <div>
                                    <label for="salePrice" class="block text-xs font-bold text-white mb-1">{{
                                        'sale_price'
                                        | translate }}</label>
                                    <input type="text" appCurrencyMask id="salePrice" formControlName="salePrice"
                                        class="clyro-input" placeholder="0.00">
                                    <p class="text-[10px] text-gray-400 mt-1">{{ 'sale_price_desc' | translate }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fixed Button Area at Bottom -->
                    <div class="p-4 sm:p-6 pt-4 border-t border-white/10 bg-gradient-to-t from-black/20 to-transparent">
                        <button type="submit" [disabled]="financialForm.pristine"
                            class="w-full flex justify-center py-3 px-4 rounded-xl shadow-lg text-xs font-bold text-white btn-neon-cyan disabled:opacity-50 disabled:cursor-not-allowed">
                            {{ 'save_financial_data' | translate }}
                        </button>
                    </div>
                </form>
            </div>
            <!-- Analysis -->
            <div class="lg:w-1/2">
                <div
                    class="glass-content p-4 sm:p-6 h-full flex flex-col overflow-auto max-h-[calc(100vh-12rem)] custom-scrollbar">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-white">{{ 'financial_analysis' | translate }}</h2>
                        <div class="relative">
                            <button (click)="showExportMenu.set(!showExportMenu())"
                                class="inline-flex items-center px-3 py-2 border border-white/10 rounded-xl shadow-sm text-xs font-medium text-white btn-secondary-glass btn-export-neon">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                {{ 'export_data' | translate }}
                            </button>
                            @if(showExportMenu()) {
                            <div
                                class="absolute right-0 mt-2 w-48 bg-[#0A0F1A] border border-white/10 rounded-xl shadow-xl py-1 z-10 backdrop-blur-xl">
                                <a (click)="exportAnalysis('pdf')"
                                    class="cursor-pointer block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white">{{
                                    'export_format_pdf' | translate }}</a>
                                <a (click)="exportAnalysis('txt')"
                                    class="cursor-pointer block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white">{{
                                    'export_format_txt' | translate }}</a>
                                <a (click)="exportAnalysis('md')"
                                    class="cursor-pointer block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white">{{
                                    'export_format_md' | translate }}</a>
                            </div>
                            }
                        </div>
                    </div>
                    @if (analysisInBRL(); as data) {
                    <div class="space-y-6 flex-grow">
                        <div class="flex justify-between items-center p-4 neon-card glass-transition">
                            <span class="text-sm text-gray-300">{{ 'net_balance' | translate }}</span>
                            <span class="text-xl font-bold"
                                [class]="data.netBalance >= 0 ? 'text-green-400 drop-shadow-[0_0_8px_rgba(74,222,128,0.3)]' : 'text-red-400 drop-shadow-[0_0_8px_rgba(248,113,113,0.3)]'">
                                {{ data.netBalance | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
                            </span>
                        </div>
                        <div class="flex justify-between items-center p-4 neon-card glass-transition"
                            style="animation-delay: 0.1s">
                            <span class="text-sm text-gray-300">{{ 'profit_margin' | translate }}</span>
                            @if (data.productMargin !== null) {
                            <span class="text-xl font-bold text-cyan-400 drop-shadow-[0_0_8px_rgba(34,211,238,0.3)]">{{
                                data.productMargin * 100 | number:'1.2-2' }}%</span>
                            } @else {
                            <span class="text-sm text-gray-500">{{ 'no_margin_data' | translate }}</span>
                            }
                        </div>
                        <div class="p-4 neon-card glass-transition" style="animation-delay: 0.2s">
                            <p class="text-sm text-gray-300 mb-2">{{ 'inflation_recommendation' | translate }}</p>
                            @if (data.inflationAdjustment !== null && data.inflationAdjustment > 0) {
                            <p class="text-lg font-bold text-yellow-400 drop-shadow-[0_0_5px_rgba(250,204,21,0.3)]">
                                {{ 'increase_price_by' | translate:{ amount: (data.inflationAdjustment |
                                currency:'BRL':'symbol':'1.2-2':'pt-BR') } }}
                            </p>
                            } @else {
                            <p class="text-sm text-gray-500">{{ 'no_inflation_data' | translate }}</p>
                            }
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>