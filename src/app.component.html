<app-onboarding></app-onboarding>
<app-toast></app-toast>

<!-- GLOBAL MESH GRADIENT BACKGROUND -->
<!-- This sits behind everything. The glass components will distort this. -->
<div class="mesh-bg">
  <div class="mesh-blob mesh-blob-1"></div>
  <div class="mesh-blob mesh-blob-2"></div>
  <div class="mesh-blob mesh-blob-3"></div>
  <div class="mesh-blob mesh-blob-4"></div>
</div>

@if (isAuthenticated()) {
  <div class="relative flex h-screen overflow-hidden">
    <!-- Sidebar for Desktop -->
    <!-- Z-index ensure it floats above the mesh but below modals -->
    <div class="hidden md:flex flex-shrink-0 relative z-20">
       <app-sidebar></app-sidebar>
    </div>

    <!-- Sidebar for Mobile (Overlay) -->
    @if (sidebarOpen()) {
      <div class="md:hidden absolute inset-y-0 left-0 z-30 transition-transform">
        <app-sidebar></app-sidebar>
      </div>
      <!-- Overlay backdrop -->
      <div (click)="sidebarOpen.set(false)" class="md:hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-20"></div>
    }
    
    <div class="flex-1 flex flex-col overflow-hidden relative z-10">
      <app-header></app-header>
      <main class="flex-1 overflow-x-hidden overflow-y-auto scroll-smooth flex flex-col">
        <!-- Main content area is transparent so the mesh shows through -->
        <div class="flex-grow p-4 md:p-8">
          <router-outlet></router-outlet>
        </div>
        <app-footer></app-footer>
      </main>
    </div>
  </div>
} @else {
  <!-- Auth Layout: Content sits directly on mesh -->
  <div class="min-h-screen relative z-10">
    <router-outlet></router-outlet>
  </div>
}